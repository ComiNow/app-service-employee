<div class="container mx-auto px-4 py-8 mt-16">
  <h1 class="text-3xl font-bold mb-8">Mi Carrito</h1>

  @if (items.length > 0) {
  <div class="flex flex-col lg:flex-row gap-8">
    <div class="flex-grow">
      @for (item of items; track item.product.id) {
      <cart-item [item]="item" />
      }
    </div>

    <div class="lg:w-1/3">
      <div class="bg-sidebar-gray rounded-3xl shadow-md p-6">
        <h2 class="text-xl font-bold mb-4">Resumen de Compra</h2>

        <div class="space-y-2 mb-6">
          <div class="flex justify-between">
            <span>Productos ({{ totalItems }})</span>
            <span>$ {{ totalAmount | number }}</span>
          </div>
          <hr class="border-gray-300" />
          <div class="flex justify-between font-bold text-lg">
            <span>Total</span>
            <span>$ {{ totalAmount | number }}</span>
          </div>
        </div>

        <button
          class="bg-button-gray hover:bg-button-gray-hover text-white rounded-2xl cursor-pointer px-4 py-3 font-bold w-full mb-4 flex items-center justify-center gap-2"
          [disabled]="isCheckingOut() || isClearing()"
          [class.opacity-70]="isCheckingOut() || isClearing()"
          (click)="onCheckout()"
        >
          @if (isCheckingOut()) {
            <span class="loading loading-spinner loading-sm text-white"></span>
          } @else {
            Proceder al Pago
          }
        </button>

        <button
          class="border border-button-gray text-button-gray rounded-2xl cursor-pointer px-4 py-3 font-bold w-full hover:bg-gray-100 flex items-center justify-center gap-2"
          [disabled]="isClearing() || isCheckingOut()"
          [class.opacity-70]="isClearing() || isCheckingOut()"
          (click)="clearCart()"
        >
           @if (isClearing()) {
            <span class="loading loading-spinner loading-sm text-button-gray"></span>
          } @else {
            Vaciar Carrito
          }
        </button>

        <div class="mt-6">
          <a
            routerLink="/"
            class="text-button-gray hover:underline flex items-center justify-center"
          >
            <span class="mr-2">←</span> Seguir Comprando
          </a>
        </div>
      </div>
    </div>
  </div>
  } @else {
  <div class="flex flex-col items-center justify-center py-12 text-center">
    <svg
      xmlns="http://www.w3.org/2000/svg"
      class="w-24 h-24 text-gray-400 mb-4"
      fill="none"
      viewBox="0 0 24 24"
      stroke="currentColor"
    >
      <path
        stroke-linecap="round"
        stroke-linejoin="round"
        stroke-width="2"
        d="M16 11V7a4 4 0 00-8 0v4M5 9h14l1 12H4L5 9z"
      />
    </svg>
    <h2 class="text-2xl font-bold mb-2">Tu carrito está vacío</h2>
    <p class="text-gray-600 mb-6">
      ¡Agrega algunos productos para comenzar a comprar!
    </p>
    <a
      routerLink="/"
      class="bg-button-gray hover:bg-button-gray-hover text-white rounded-2xl cursor-pointer px-6 py-3 font-bold"
    >
      Ir a la Tienda
    </a>
  </div>
  }
</div>